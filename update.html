<!DOCTYPE html>
<html lang="zh-CN">
<head>
    </head>
<body>
    <div id="status-message">
        <h1>正在获取最新版本信息...</h1>
        <div class="spinner"></div> 
        <p>请等待加载完成，然后点击下方按钮开始下载。</p>
    </div>

    <script>
        const JSON_URL = 'update_version.json'; 

        // 获取并解析 JSON
        fetch(JSON_URL, { cache: "no-store" })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`网络请求失败，状态码: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                const latestDownloadUrl = data.url; 
                
                if (latestDownloadUrl && latestDownloadUrl.startsWith('http')) {
                    // *** 【关键修改】 ***
                    // 成功获取到 URL，更新页面内容，显示下载按钮
                    document.getElementById('status-message').innerHTML = `
                        <h1>已准备就绪！</h1>
                        <p>应用版本: ${data.versionName} (${data.versionCode})</p>
                        <p>文件大小: ${data.pkgSize} KB</p>
                        
                        <a class="btn" href="${latestDownloadUrl}">
                            点击下载最新版本 APK
                        </a>
                        
                        <p style="margin-top: 20px; color: gray;">
                           下载前，您可能需要授予浏览器下载权限。
                        </p>
                    `;
                    // *** 【关键修改结束】 ***
                    
                } else {
                    throw new Error("JSON数据无效或缺少有效的下载URL。");
                }
            })
            .catch(error => {
                // ... (错误处理逻辑保持不变) ...
            });
    </script>
</body>
</html>
